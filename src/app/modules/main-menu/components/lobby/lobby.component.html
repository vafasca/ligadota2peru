<div class="lobby-container">
  <!-- Cabecera del perfil -->
  <div class="profile-header">
    <!-- Parte 1: Datos del perfil -->
    <div class="profile-section profile-data">
      <div class="avatar-container">
        <img
          [src]="player.avatar"
          (click)="goToProfile()"
          alt="Avatar"
          class="profile-avatar"
        />
        <div class="status-indicator" [ngClass]="getStatusClass()"></div>
      </div>
      <div class="player-info">
        <h1 class="dota-font">{{ player.nick }}</h1>
        <div class="player-meta">
          <span class="player-id">ID Dota 2: {{ player.idDota }}</span>
          <span class="player-mmr">
            <img [src]="player.medalImage" class="medal-icon">
            {{ player.mmr }} MMR
          </span>
          <!-- <span class="player-category tier-{{player.category.toLowerCase()}}">
            {{ player.category }}
          </span> -->
        </div>
        <div class="player-roles">
          <span class="role-badge primary-role">{{ player.role }}</span>
          <span class="role-badge secondary-role">{{ player.secondaryRole }}</span>
        </div>
      </div>
    </div>

    <!-- Parte 2: Botones de acción -->
    <div class="profile-actions">
  <div class="action-buttons-grid">
    <div class="button-row">
      <button class="dota-button-middle status-toggle" (click)="toggleStatus()">
        <i class="fas fa-circle"></i> {{ player.status }}
      </button>
      <button class="dota-button-middle edit-profile-button" (click)="goToEditProfile()">
        <i class="fas fa-user-edit"></i> Editar
      </button>
    </div>
    <div class="button-row">
      <button class="dota-button-middle admin-button" (click)="goToAdmin()">
        <i class="fas fa-shield-alt"></i> Admin
      </button>
      <button class="dota-button-middle logout-button" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i> Salir
      </button>
    </div>
  </div>
</div>

    <!-- Parte 3: Redes sociales -->
    <div class="profile-section social-media-container">
      <div class="social-media-grid">
        <div class="social-media-row">
          <ng-container *ngIf="player.socialMedia?.twitch; else noTwitch">
            <a [href]="player.socialMedia?.twitch" target="_blank" title="Twitch">
              <img src="https://cdn-icons-png.flaticon.com/512/5968/5968819.png" alt="Twitch"/>
            </a>
          </ng-container>
          <ng-template #noTwitch>
            <div class="social-icon-disabled" title="Twitch no disponible">
              <img src="https://cdn-icons-png.flaticon.com/512/5968/5968819.png" alt="Twitch"/>
            </div>
          </ng-template>

          <ng-container *ngIf="player.socialMedia?.youtube; else noYoutube">
            <a [href]="player.socialMedia?.youtube" target="_blank" title="YouTube">
              <img src="https://cdn-icons-png.flaticon.com/128/174/174883.png" alt="YouTube"/>
            </a>
          </ng-container>
          <ng-template #noYoutube>
            <div class="social-icon-disabled" title="YouTube no disponible">
              <img src="https://cdn-icons-png.flaticon.com/128/174/174883.png" alt="YouTube"/>
            </div>
          </ng-template>

          <ng-container *ngIf="player.socialMedia?.kick; else noKick">
            <a [href]="player.socialMedia?.kick" target="_blank" title="Kick">
              <img src="https://kick.com/favicon.ico" alt="Kick"/>
            </a>
          </ng-container>
          <ng-template #noKick>
            <div class="social-icon-disabled" title="Kick no disponible">
              <img src="https://kick.com/favicon.ico" alt="Kick"/>
            </div>
          </ng-template>

          <ng-container *ngIf="player.socialMedia?.twitter; else noTwitter">
            <a [href]="player.socialMedia?.twitter" target="_blank" title="X">
              <img src="https://cdn-icons-png.flaticon.com/128/5968/5968830.png" alt="X"/>
            </a>
          </ng-container>
          <ng-template #noTwitter>
            <div class="social-icon-disabled" title="X no disponible">
              <img src="https://cdn-icons-png.flaticon.com/128/5968/5968830.png" alt="X"/>
            </div>
          </ng-template>
        </div>

        <div class="social-media-row">
          <ng-container *ngIf="player.socialMedia?.discord; else noDiscord">
            <a [href]="player.socialMedia?.discord" target="_blank" title="Discord">
              <img src="https://cdn-icons-png.flaticon.com/512/5968/5968756.png" alt="Discord"/>
            </a>
          </ng-container>
          <ng-template #noDiscord>
            <div class="social-icon-disabled" title="Discord no disponible">
              <img src="https://cdn-icons-png.flaticon.com/512/5968/5968756.png" alt="Discord"/>
            </div>
          </ng-template>

          <ng-container *ngIf="player.socialMedia?.instagram; else noInstagram">
            <a [href]="player.socialMedia?.instagram" target="_blank" title="Instagram">
              <img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram"/>
            </a>
          </ng-container>
          <ng-template #noInstagram>
            <div class="social-icon-disabled" title="Instagram no disponible">
              <img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram"/>
            </div>
          </ng-template>

          <ng-container *ngIf="player.socialMedia?.facebook; else noFacebook">
            <a [href]="player.socialMedia?.facebook" target="_blank" title="Facebook">
              <img src="https://cdn-icons-png.flaticon.com/512/5968/5968764.png" alt="Facebook"/>
            </a>
          </ng-container>
          <ng-template #noFacebook>
            <div class="social-icon-disabled" title="Facebook no disponible">
              <img src="https://cdn-icons-png.flaticon.com/512/5968/5968764.png" alt="Facebook"/>
            </div>
          </ng-template>

          <ng-container *ngIf="player.socialMedia?.tiktok; else noTiktok">
            <a [href]="player.socialMedia?.tiktok" target="_blank" title="TikTok">
              <img src="https://cdn-icons-png.flaticon.com/512/3046/3046126.png" alt="TikTok"/>
            </a>
          </ng-container>
          <ng-template #noTiktok>
            <div class="social-icon-disabled" title="TikTok no disponible">
              <img src="https://cdn-icons-png.flaticon.com/512/3046/3046126.png" alt="TikTok"/>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <!-- Contenido principal del lobby -->
  <div class="lobby-content">
    <h1 class="lobby-title dota-font">LOBBY DE JUGADORES</h1>
    <div class="lobby-subtitle">
      <!-- Alternativa más destacada -->
      <div class="online-players-badge">
        <div class="online-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="online-count">
          <span class="count">{{ allActivePlayers.length }}</span>
          <span class="label">JUGADORES EN LÍNEA</span>
        </div>
      </div>
    </div>

    <!-- Sección de Mi Equipo -->
    <div class="team-section" *ngIf="showTeamSection">
      <div class="team-header">
        <h2 class="section-title dota-font">MI EQUIPO</h2>

        <div class="team-info" *ngIf="userTeam">
          <div class="team-banner">
            <div class="team-logo-placeholder">
              <img
                src="assets/medallas/profile_default.png"
                alt="Logo del equipo"
                class="team-logo"
              />
            </div>
            <div class="team-main-info">
              <h3 class="team-name">{{ userTeam.name }}</h3>
              <div class="team-meta">
                <span
                  class="team-category tier-{{
                    userTeam.category.toLowerCase()
                  }}"
                >
                  {{ userTeam.category }}
                </span>
                <span class="team-players-count">
                  <i class="fas fa-users"></i> {{ userTeam.players.length }}/5
                </span>
                <span class="team-captain">
                  <i class="fas fa-crown"></i> Capitán
                </span>
              </div>
            </div>
          </div>

          <div class="team-description">
            <p>{{ userTeam.description || "Sin descripción" }}</p>
          </div>
        </div>

        <div class="team-actions" *ngIf="userTeam">
          <button class="dota-button leave-team-button" (click)="leaveTeam()">
            <i class="fas fa-door-open"></i>
            {{ isTeamCaptain ? "Disolver Equipo" : "Abandonar Equipo" }}
          </button>
        </div>

        <button
          *ngIf="isTeamCaptain && !userTeam"
          class="dota-button create-team-button"
          (click)="openCreateTeamDialog()"
        >
          Crear Equipo
        </button>
      </div>

      <div class="team-roles-container" cdkDropListGroup>
        <!-- Repetir para cada rol -->
        <div
          class="team-role-card"
          *ngFor="let role of roles"
          [cdkDropListDisabled]="!isTeamCaptain"
          cdkDropList
          [cdkDropListData]="teamPlayers | filterByRole : role"
          [id]="role"
          (cdkDropListDropped)="onDrop($event)"
        >
          <h3 class="role-title">{{ role }}</h3>

          <!-- Jugador asignado a este rol -->
          <div
            class="role-player"
            *ngFor="let player of teamPlayers | filterByRole : role"
            cdkDrag
            [cdkDragDisabled]="!isTeamCaptain"
            [cdkDragData]="player"
          >
            <img
              [src]="player.avatar"
              alt="Avatar"
              class="team-player-avatar"
            />
            <div class="team-player-info">
              <div class="team-player-nick">{{ player.nick }}</div>
              <div class="team-player-mmr">
                {{ player.mmr }}
                <img [src]="player.medalImage" class="team-player-medal" />
              </div>
              <!-- Mostrar ID de Dota 2 en lugar de los roles -->
              <!-- Modifica el HTML para mostrar feedback -->
              <div
                class="team-player-dotaid"
                (click)="copyDotaId(player.idDota)"
                [class.copied]="lastCopiedId === player.idDota"
                title="Click para copiar ID"
              >
                <i class="fab fa-steam"></i>
                <span class="id-text">
                  {{
                    lastCopiedId === player.idDota
                      ? "¡Copiado!"
                      : "ID: " + (player.idDota || "N/A")
                  }}
                </span>
              </div>
              <div
                class="team-player-actions"
                *ngIf="isTeamCaptain && player.uid !== currentUserUid"
              >
                <button
                  class="dota-button small-button remove-button"
                  (click)="
                    removePlayerFromTeam(player); $event.stopPropagation()
                  "
                >
                  Remover
                </button>
              </div>
            </div>
          </div>

          <!-- Espacio vacío para arrastrar jugadores -->
          <div
            class="empty-role"
            *ngIf="isTeamCaptain && !hasPlayerInRole(role)"
          >
            <button class="add-player-btn">+ Arrastrar aquí</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Filtros de búsqueda -->
    <div class="filters-container">
      <!-- Nuevo selector para cambiar entre rol principal/secundario -->
      <div class="filter-group">
        <label for="roleTypeFilter" class="filter-label">Mostrar:</label>
        <select
          id="roleTypeFilter"
          class="dota-select"
          [(ngModel)]="selectedRoleType"
          (change)="applyFilters()"
        >
          <option value="primary">Rol principal</option>
          <option value="secondary">Rol secundario</option>
        </select>
      </div>

      <!-- Botón de capitán centrado -->
      <div
        class="captain-button-container"
        *ngIf="!userTeam && player.availability === 'available'"
      >
        <button
          class="dota-button captain-toggle-button"
          (click)="toggleCaptainStatus()"
        >
          <i class="fas fa-crown"></i>
          {{ isTeamCaptain ? "Dejar de ser Capitán" : "Volverse Capitán" }}
        </button>
      </div>

      <button class="dota-button filter-button" (click)="buscarRivales($event)">
        Buscar Rivales
      </button>

      <button class="dota-button refresh-button" (click)="enCurso()">
        <i class="fas fa-sync-alt"></i> Partidas en Curso
      </button>
    </div>

    <!-- Lista de jugadores por categoría -->
    <div
      class="players-by-category"
      *ngFor="let category of filteredCategories"
    >
      <h2 class="category-title dota-font">
        {{ category }}
        <span class="player-count">
          ({{ getPlayersByCategory(category).length }} jugadores)
        </span>
      </h2>

      <div class="role-columns-container">
        <!-- Columna para cada rol -->
        <div class="role-column-wrapper" *ngFor="let role of roles">
          <h3 class="role-title">
            {{ role }}
            <span class="role-player-count"
              >({{ getPlayersByCategoryAndRole(category, role).length }})</span
            >
          </h3>
          <div class="role-column">
            <div class="players-container">
              <div
                class="player-card"
                *ngFor="
                  let player of getPlayersByCategoryAndRole(category, role)
                "
                (click)="viewProfile(player)"
              >
                <div class="player-avatar-container">
                  <img
                    [src]="player.avatar"
                    alt="Avatar"
                    class="player-avatar"
                  />
                  <div
                    class="player-status"
                    [ngClass]="getPlayerStatusClass(player)"
                  ></div>
                </div>

                <div class="player-info">
                  <div class="player-nick">{{ player.nick }}</div>
                  <div class="player-mmr">
                    <span>{{ player.mmr }}</span>
                    <img
                      [src]="player.medalImage"
                      [alt]="player.medal"
                      class="player-medal"
                      title="{{ player.medal }}"
                    />
                  </div>
                  <div class="player-role">Rating {{ player.rating }}</div>
                </div>

                <div
                  class="player-actions"
                  *ngIf="
                    isTeamCaptain && userTeam && userTeam.players.length < 5
                  "
                >
                  <button
                    class="dota-button small-button add-button"
                    (click)="addPlayerToTeam(player); $event.stopPropagation()"
                    title="Añadir al equipo"
                  >
                    +
                  </button>
                </div>
              </div>

              <div
                class="empty-role"
                *ngIf="getPlayersByCategoryAndRole(category, role).length === 0"
              >
                No hay jugadores disponibles
                <div
                  *ngIf="
                    category === 'Tier1' ||
                    'Tier2' ||
                    'Tier3' ||
                    'Tier4' ||
                    'Tier5'
                  "
                  class="info-note"
                >
                  (Los capitanes de equipo no aparecen en esta lista)
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
